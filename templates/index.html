<!DOCTYPE html>
<html>

<head>
  <link href='https://fonts.googleapis.com/css?family=Nobile:700,400' rel='stylesheet' type='text/css'>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/d3-array.v2.min.js"></script>
  <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
  <style>
    .video-container {
      position: relative;
      width: 1280px;
    }

    .overlay-desc {
      background: rgba(0, 0, 0, 0);
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      margin-bottom: 10%;
    }

    .var {
      position: absolute;
      top: 50px;
      bottom: 0;
      left: 30px;
      color: white;
      font-family: 'Nobile', sans-serif;
      font-size: 30px;
    }
  </style>
</head>

<body>
  <input type="file" id="input">
  <div class="video-container" width="1280px">
    <video width="100%" id="video" controls loop>
      <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
      Your browser does not support HTML5 video.
    </video>
    <div class="overlay-desc" class="row">
      <div id="var1" class="var"><br></div>
      <!-- <div class="col-lg-4"><br></div>
    <div id="time" class="col-lg-4 var" style="text-align: right">Topic 3</div> -->
    </div>
  </div>

</body>

<script>

  var reader = new FileReader();
  reader.onload = function () {
    //Txt file output
    var txtRes = reader.result;
    // Init the "SSV" parser, which splits data on semi-colons
    var parser = d3.dsvFormat(';')
    data = parser.parse(txtRes, function (d) {
      return {
        time: +d.time,
        var1: +d.var1,
        var2: +d.var2
      }
    })

    time_arr = [];
    var1_arr = [];
    for (i = 0; i < data.length; i++) {
      time_arr.push(data[i].time)
      var1_arr.push(data[i].var1)
    }

    window.data = { time: time_arr, var1: var1_arr };

    function displayTime(event) {
      t = document.getElementById("video").currentTime

      idx = d3.minIndex(window.data.time.map(x => Math.abs(x - t)));

      document.getElementById("var1").innerHTML = Number(window.data.var1[idx]).toFixed(2) + "m/s";
      //document.getElementById("time").innerHTML =  Number(t).toFixed(0) + "s";
    }

    //document.getElementById("video").addEventListener("playing", displayTime);
    window.setInterval(displayTime, 100)
  };

  var inputElement = document.getElementById("input");
  inputElement.addEventListener("change", handleFiles, false);

  function handleFiles() {
    reader.readAsText(this.files[0]);
  }

</script>

</html>